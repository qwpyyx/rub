<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>SZU Rub Badminton</title>
</head>

<body>
    <a href="add" style="display: inline-block; margin-top: 1rem">add login information</a>
    <a href="stop" style="display: inline-block; margin-top: 1rem;">stop the current goroutine</a>
    <h1>预约信息</h1>
    <label for="userSelect">Choose a User:</label>
    <select name="userSelect" id="userSelect" onchange="onSelectFunction()">
        <option value="">Please choose an option if needed</option>
        {{range $i, $v := .UserInfo}}
        <option value="{{$v.UserId}}" data-username="{{$v.UserName}}" data-userid="{{$v.UserId}}" data-password="{{$v.Password}}"
            data-phone="{{$v.PhoneNumber}}" data-date="{{$v.SportDate}}" data-first="{{$v.FirstTime}}" data-second="{{$v.SecondTime}}"
            {{if and $.FormUser (eq $v.UserId $.FormUser.UserId)}}selected{{end}}>{{$v.UserName}}</option>
        {{end}}
    </select>
    <br />
    <br />
    {{ if .Message }}
    <h1>预约结果: {{ .Message }}</h1>
    {{ end }}
    {{ if eq .ConfigMessage "saved" }}
    <h2 style="color: green;">短信配置已保存，可直接使用 main.exe</h2>
    {{ end }}
    <h2>短信提醒配置 (Aliyun SMS)</h2>
    <form method="POST" action="/config" style="margin-bottom: 2rem;">
        <label>AccessKey ID:</label>
        <input type="text" name="sms_access_key_id" value="{{ if .Config }}{{ .Config.AccessKeyID }}{{ end }}" required><br /><br />
        <label>AccessKey Secret:</label>
        <input type="password" name="sms_access_key_secret" value="{{ if .Config }}{{ .Config.AccessKeySecret }}{{ end }}" required><br /><br />
        <label>短信签名 (SignName):</label>
        <input type="text" name="sms_sign_name" value="{{ if .Config }}{{ .Config.SignName }}{{ end }}" required><br /><br />
        <label>短信模板编码 (TemplateCode):</label>
        <input type="text" name="sms_template_code" value="{{ if .Config }}{{ .Config.TemplateCode }}{{ end }}" required><br /><br />
        <label>区域 ID (默认 cn-hangzhou):</label>
        <input type="text" name="sms_region_id" value="{{ if .Config }}{{ .Config.RegionID }}{{ end }}" placeholder="cn-hangzhou"><br /><br />
        <small>请先在阿里云短信控制台开通服务、创建签名和模板，然后把对应的 Key、签名、模板编码填在这里并保存。</small><br /><br />
        <input type="submit" value="保存短信配置" />
    </form>
    <form method="POST">
        <label>姓名:</label>
        <input type="text" id="user_name" name="user_name" value="{{if .FormUser}}{{.FormUser.UserName}}{{end}}" required><br /><br />
        <label>学号:</label>
        <input type="text" id="user_id" name="user_id" value="{{if .FormUser}}{{.FormUser.UserId}}{{end}}" required><br /><br />
        <label>密码:</label>
        <input type="password" id="password" name="password" value="{{if .FormUser}}{{.FormUser.Password}}{{end}}" required><br /><br />
        <label>手机号:</label>
        <input type="tel" id="phone_number" name="phone_number" value="{{if .FormUser}}{{.FormUser.PhoneNumber}}{{end}}" placeholder="11位手机号" required><br /><br />
        <label for="sportDate">预约日期:</label>
        <input type="date" id="sportDate" name="sportDate" value="{{if .FormUser}}{{.FormUser.SportDate}}{{else}}2023-09-17{{end}}" min="2023-09-17"
            max="2025-07-01" /><br /><br />
        <label for="firstTime">第一个场次时间:</label>
        <input type="time" id="firstTime" name="firstTime" value="{{if .FormUser}}{{.FormUser.FirstTime}}{{else}}20:00{{end}}" step="3600" required /><br /><br />
        <label for="secondTime">第二个场次时间 (如果不需要预约第二个场就不用填):</label>
        <input type="time" id="secondTime" name="secondTime" value="{{if .FormUser}}{{.FormUser.SecondTime}}{{else}}00:00{{end}}" step="3600" required /><br /><br />
        <div>
            <input type="checkbox" id="ifExecuteNow" name="ifExecuteNow" value="1" />
            <label for="ifExecuteNow">现在执行预约?</label>
        </div>
        <br />
        <input type="submit">
    </form>
</body>
<script>

    function onSelectFunction(event) {
        let $select = document.getElementById("userSelect");
        let $userName = document.getElementById("user_name");
        let $userId = document.getElementById("user_id");
        let $password = document.getElementById("password");
        let $phone = document.getElementById("phone_number");
        let $date = document.getElementById("sportDate");
        let $first = document.getElementById("firstTime");
        let $second = document.getElementById("secondTime");
        if ($select.value != "") {
            const option = $select.options[$select.selectedIndex];
            $userName.value = option.dataset.username || "";
            $userId.value = option.dataset.userid || "";
            $password.value = option.dataset.password || "";
            $phone.value = option.dataset.phone || "";
            $date.value = option.dataset.date || $date.value;
            $first.value = option.dataset.first || $first.value;
            $second.value = option.dataset.second || $second.value;
        } else {
            $userName.value = "";
            $userId.value = "";
            $password.value = "";
            $phone.value = "";
            $date.value = "";
            $first.value = "";
            $second.value = "";
        }
    }

    Object.defineProperty(HTMLFormElement.prototype, 'formdata', {
        get() {
            return new FormData(this);
        }
    })
</script>

</html>